---
title: "Case Study 2 _ How Can a Wellness Technology Company Play It Smart?"
author: "Taufiqur Rohman"
date: '2022-03-15'
output: html_document
---

## Introduction

In this case study, I play the part of a junior data analyst on the Bellabeat marketing analyst team, a high-tech maker of women's health goods. Bellabeat is a thriving small business with the potential to grow into a major player in the worldwide smart device industry. Bellabeat's Chief Creative Officer believes that examining smart device fitness data might help the firm unlock new growth potential.

I've been requested to focus on one of Bellabeat's products and analyze smart device data to learn more about how people use their phones. The information you gather will subsequently be used to drive the company's marketing strategy. I'll deliver my findings to the Bellabeat management team, along with some high-level marketing plan ideas.

*Notes: The packages and library used in this Rmd is not stated in the code chunk. Please install it before when the error message appears.*

### About the company

Bellabeat is a high-tech company that manufactures health-focused smart products. Collecting data on activity, sleep, stress, and reproductive health has allowed Bellabeat to empower women with knowledge about their own health and habits. Since it was founded in 2013, Bellabeat has grown rapidly and quickly positioned itself as a tech-driven wellness company for women.

By 2016, Bellabeat had opened offices around the world and launched multiple products. Bellabeat products became available through a growing number of online retailers in addition to their own e-commerce channel on their website.

The Chief Creative Officer knows that an analysis of Bellabeat's available consumer data would reveal more opportunities for growth. She has asked the marketing analytics team to focus on a Bellabeat product and analyze smart device usage data in order to gain insight into how people are already using their smart devices. Then, using this information, she would like high-level recommendations for how these trends can inform Bellabeat marketing strategy.

-   **Problem Statement:** Bellabeat have the potential to become a larger player in the global smart device market.
-   **Solving:**
    -   What are some trends in smart device usage?
    -   How could these trends apply to Bellabeat customers?
    -   How could these trends help influence Bellabeat marketing strategy?
-   **Goals:** Turning trends in smart device usage data into Bellabeat marketing strategy.
-   **Deliverable:**
    -   Documentation of any cleaning data
    -   Summary of the analysis
    -   Visualizations and key findings
    -   Recommendations

### Products

-   **Bellabeat app:** The Bellabeat app provides users with health data related to their activity, sleep, stress, menstrual cycle, and mindfulness habits. This data can help users better understand their current habits and make healthy decisions. The Bellabeat app connects to their line of smart wellness products.
-   **Leaf:** Bellabeat's classic wellness tracker can be worn as a bracelet, necklace, or clip. The Leaf tracker connects to the Bellabeat app to track activity, sleep, and stress.
-   **Time:** This wellness watch combines the timeless look of a classic timepiece with smart technology to track user activity, sleep, and stress. The Time watch connects to the Bellabeat app to provide you with insights into your daily wellness.
-   **Spring:** This is a water bottle that tracks daily water intake using smart technology to ensure that you are appropriately hydrated throughout the day. The Spring bottle connects to the Bellabeat app to track your hydration levels.
-   **Bellabeat membership:** Bellabeat also offers a subscription-based membership program for users. Membership gives users 24/7 access to fully personalized guidance on nutrition, activity, sleep, health and beauty, and mindfulness based on their lifestyle and goals.

## Step 1: Importing data

The dataset used in this case study is FitBit Fitness Tracker Data. It is generated by respondents to a distributed survey via Amazon Mechanical Turk between 03.12.2016-05.12.2016.

Thirty eligible Fitbit users consented to the submission of personal tracker data, including minute-level output for physical activity, heart rate, and sleep monitoring. Individual reports can be parsed by export session ID (column A) or timestamp (column B). Variation between output represents use of different types of Fitbit trackers and individual tracking behaviors / preferences.

The data can be downloaded here: <https://www.kaggle.com/arashnic/fitbit>

```{r importing data}
myfiles = list.files(pattern="*.csv")
for (i in 1:length(myfiles)) assign(myfiles[i], read.csv(myfiles[i]))
```

There's a lot of data here. I am interested in daily data first. So, I will start by inspecting "dailyActivity_merged.csv" and "sleepDay_merged.csv".

## Step 2: Inspect & clean data

First, I preview the data using the `head()` function by running the chunk below:

```{r preview by head}
head(dailyActivity_merged.csv)
head(sleepDay_merged.csv)
```

Then, I checked the data type using `str()` as shown in the chunk below:

```{r data type}
str(dailyActivity_merged.csv)
str(sleepDay_merged.csv)
```

Turns out that the date is in string format. So, I convert the date from string to date format using code chunk below:

```{r formatting date}
dailyActivity_merged.csv$ActivityDate <- 
  as.Date(dailyActivity_merged.csv$ActivityDate, "%m/%d/%Y")

sleepDay_merged.csv$SleepDay <- 
  as.Date(sleepDay_merged.csv$SleepDay, "%m/%d/%Y")

str(dailyActivity_merged.csv$ActivityDate)
str(sleepDay_merged.csv$SleepDay)
```

For the last step of inspection, I am trying to find out what columns I have in my data frame by try running the the `colnames()` function in the code chunk below:

```{r column names}
colnames(dailyActivity_merged.csv)
colnames(sleepDay_merged.csv)
```

```{r create a column for day of week}
#Daily Activity
day_of_week <- weekdays(as.Date(dailyActivity_merged.csv$ActivityDate))

dailyActivity_merged.csv <- dailyActivity_merged.csv %>% 
  add_column(day_of_week = day_of_week) 

#Daily Sleep
day_of_week <- weekdays(as.Date(sleepDay_merged.csv$SleepDay))

sleepDay_merged.csv <- sleepDay_merged.csv %>% 
  add_column(day_of_week = day_of_week) 

head(dailyActivity_merged.csv)
head(sleepDay_merged.csv)
```

Let's see the overview of the data.

```{r comprehensive summary of the data}
skim_without_charts(dailyActivity_merged.csv)
skim_without_charts(sleepDay_merged.csv)
```

The data is clean and I am ready to move to analyze the data.

## Step 3: Analyzing Data and Visualization

To start analyze data, I am trying to get the summary of the overall data to get the big picture of the data and to know whether there is is (an) errors in the data.

```{r summary of data}
summary(dailyActivity_merged.csv)
summary(sleepDay_merged.csv)
```

### Daily Activities Analysis

I start by checking the trend of total daily steps, distance, and calories by day of week. 

```{r total steps and distance by day}
# Ordering by day of week
x <- c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")

# Grouping by day of week 
z_dow_x_daily <- dailyActivity_merged.csv %>% 
  group_by(day_of_week) %>% 
  slice(match(x, day_of_week)) %>% 
  summarise(avg_totalsteps = mean(TotalSteps), avg_totaldistance = mean(TotalDistance), avg_calories = mean(Calories))

z_dow_x_daily

# Creating bar chart
z_dow_x_daily$day_of_week <- factor(z_dow_x_daily$day_of_week, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))

ggplot(data = z_dow_x_daily) +
  geom_bar(mapping = aes
          (x = day_of_week, y = avg_calories), 
          stat = "identity", position = "dodge", fill = "blue")

  ggplot(data = z_dow_x_daily) +
  geom_bar(mapping = aes
          (x = day_of_week, y = avg_totaldistance), 
          stat = "identity", position = "dodge", fill = "red")
    
```
Turns out that people usually walk more in Monday, Tuesday, and Saturday.

Next, I want to know the behavior of people when walking, whether they only did a light, moderate, or very active walk. 

```{r average walk behavior}
daily_merged %>% 
  summarize(avg_light = mean(LightActiveDistance), avg_moderate = mean(ModeratelyActiveDistance), avg_very = mean(VeryActiveDistance), avg_dist = mean(TotalDistance))
```
I found that most of people do a light walk.

Next, I still have the calories data. I try to find the correlation between total steps and calories. I didn't examine the correlation for total distance because from the previous bar chart, I am sure that total steps and total distance have a high correlation. Thus, I can skip it.

```{r correlation total steps x calories}
ggscatter(dailyActivity_merged.csv, x = "TotalSteps", y = "Calories", 
          add = "reg.line", conf.int = TRUE, 
          cor.coef = TRUE, cor.method = "pearson",
          xlab = "TotalSteps", ylab = "Calories")
```

Turns out that there is a significance moderate correlation between total steps and calories burned (R = 0.59, p < 0.05) which very make sense.

### Daily Sleep Behavior

Next, I calculate the average minutes people asleep and their time in bed by day of week.

```{r minutes asleep by day of week}
# Ordering day of week 
x <- c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday")

# Calculating mean of minutes asleep and time in bed 
z_sleep_x_daily <- sleepDay_merged.csv %>% 
  group_by(day_of_week) %>% 
  summarise(avg_minutesasleep = mean(TotalMinutesAsleep), avg_timeinbed = mean(TotalTimeInBed)) %>% 
  slice(match(x, day_of_week))

z_sleep_x_daily

# Creating bar chart
z_sleep_x_daily$day_of_week <- factor(z_sleep_x_daily$day_of_week, levels = c("Monday", "Tuesday", "Wednesday", "Thursday", "Friday", "Saturday", "Sunday"))

ggplot(data = z_sleep_x_daily) +
  geom_bar(mapping = aes
          (x = day_of_week, y = avg_minutesasleep), 
          stat = "identity", position = "dodge", fill = "blue")
```
Although the difference is not very significance, the data shows that people sleep longer on Wednesday, Saturday, and Sunday.

### Correlation of Daily Activities and Sleep Behavior Analysis

I find that it will be interesting if I can know the correlation between daily activity and sleep behavior of the users. Thus, I start by merging the daily activity and sleep behavior by joining based on Id, and the date of the record in both of data frames.

```{r merging daily activity and sleep dataframe}
# Joining two data frame into one
daily_merged <- merge(dailyActivity_merged.csv, sleepDay_merged.csv, by.x=c("Id", "ActivityDate"), by.y=c("Id", "SleepDay"))

# Cleaning new data frame
daily_merged <- select(daily_merged, -day_of_week.x)
names(daily_merged)[names(daily_merged) == 'day_of_week.y'] <- 'day_of_week'

daily_merged
```

Next, I create correlation matrix to check the magnitude of correlation between activities and sleep. I divide it into two data frames (high correlation and low to moderate correlation).                                   

```{r correlation of activities and sleep}
# Create correlation data frame
daily_corr <- cor(select(daily_merged, TotalDistance, VeryActiveDistance, ModeratelyActiveDistance, LightActiveDistance, SedentaryActiveDistance, Calories, TotalMinutesAsleep))

df_corr <-
as.data.frame(as.table(cor(daily_corr)))

df_corr

# Identify only weak to moderate correlation
df_corr %>% 
  filter(Freq < 0.5 & Freq > -0.5) %>% 
  distinct(Freq, .keep_all = TRUE) 

# Identify strong correlation
df_corr %>% 
  filter(Freq > 0.5 | Freq < -0.5) %>% 
  distinct(Freq, .keep_all = TRUE) 
```

Turns out that total sleep time is negatively correlated with total distance. I can say that the more people walk or active, the people will sleep more, which quite makes sense. 

Another thing we can see here is the multicollinearity between total distance and distance intensities. Also, there is a high correlation between calories and total distance. Why this is important? Because I want to analyze the data using linear regression model. From the correlation matrix, I build a model shown below:

TotalMinutesAsleep = a + (b1)TotalDistance + (b2)VeryActiveDistance + (b3)day_of_week_Tuesday + (b4)day_of_week_Wednesday + (b5)day_of_week_Thursday + (b6)day_of_week_Friday + (b7)day_of_week_Saturday + (b8)day_of_week_Sunday

```{r regression model}
# Creating the dummy variable
df_regress <- dummy_cols(daily_merged, select_columns = c('day_of_week'), remove_selected_columns = TRUE)

df_regress$day_of_week_Monday <- as.factor(df_regress$day_of_week_Monday)
df_regress$day_of_week_Tuesday <- as.factor(df_regress$day_of_week_Tuesday)
df_regress$day_of_week_Wednesday <- as.factor(df_regress$day_of_week_Wednesday)
df_regress$day_of_week_Thursday <- as.factor(df_regress$day_of_week_Thursday)
df_regress$day_of_week_Friday <- as.factor(df_regress$day_of_week_Friday)
df_regress$day_of_week_Saturday <- as.factor(df_regress$day_of_week_Saturday)
df_regress$day_of_week_Sunday <- as.factor(df_regress$day_of_week_Sunday)

str(df_regress)

# Modeling the linear regression
# Use the day_of_week_Monday variable as the baseline
regression_model <- lm(TotalMinutesAsleep ~ TotalDistance + 
                         day_of_week_Tuesday + day_of_week_Wednesday + 
                         day_of_week_Thursday + day_of_week_Friday + 
                         day_of_week_Saturday + day_of_week_Sunday, 
                       data = df_regress)
summary(regression_model)
```

```{r regression model with standardized}
# Modeling the linear regression with standardized variable
# Use the day_of_week_Monday variable as the baseline
df_regress_std <- df_regress %>% 
  mutate(TotalDistance_s = scale(TotalDistance))

df_regress_std

regression_model_std <- lm(TotalMinutesAsleep ~ TotalDistance + 
                         day_of_week_Tuesday + day_of_week_Wednesday + 
                         day_of_week_Thursday + day_of_week_Friday + 
                         day_of_week_Saturday + day_of_week_Sunday, 
                       data = df_regress_std)
summary(regression_model_std)
```

```{r evaluating model}
ypred <- predict(regression_model, df_regress)
errs <- ypred - df_regress$TotalMinutesAsleep
histogram(errs)

MSE(y_pred = regression_model$fitted.values, y_true = df_regress$TotalMinutesAsleep)
```

From the model, I found that the best predictor for total minutes asleep is their total walk distance during a day (p < 0.05). The more people walk, the less people will sleep. Day of week couldn't explain the trend of people sleep as all of the variables are not statistically significant.

Moreover, from the model, I found that the R-squared = 0.04834 which is very low. The big number of Mean Squared Error (MSE) also tells me that there are many others variable that can help explain the sleep behavior rather than only total walk distance and day of week.

## Step 4: Interpretation and Recommendation

From all of the analysis I have conducted, there are several key findings:

1. People often walk in moderate pace *(refer to chunk 10)*.
2. Total walk distance is proportional to number of calories burned *(refer to chunk 11)*.
3. Even though people sleep more on Wednesday, Saturday, and Sunday, day of week is not a good regressor to predict how long do people fell asleep *(refer to chunk 12 & 15)*.
4. A surprising fact that the more people walk, they will sleep shorter *(refer to chunk 15 and 16)*.

Based on the data, I've discovered a number of startling facts about smart device usage. On Wednesday, for example, they sleep more. Furthermore, there is a negative relationship between total walk minutes and total sleep minutes.

Bellabeat may use these surprising insights to promote themselves. The company might present the intriguing facts and then the call to action in order to communicate the advertisement. Consider the following example:

**Headline**: "Do you know that in average, the more you walk, the less you will sleep?"
**CTA**: "Curious more? Download Bellabeat now!"

Even if the data contains a great deal of information and intriguing facts, it lacks the capacity to provide marketing recommendations on a corporate and strategic level. Rather, it has the power to provide marketing at the level of communication and advertisement. As a result, Bellabeat may begin gathering data on users' demographics (e.g., age, gender, location) and user behaviour  (e.g. screen application time) in order to acquire more strategic insights and recommendations.